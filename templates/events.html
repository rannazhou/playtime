{% extends "base.html" %}

{% block title %}Playtime: Events{% endblock %}

{% block css %}
<link rel="stylesheet" type="text/css" href="site_media/css/tilesLayout.css" />
<link rel="stylesheet" type="text/css" href="site_media/css/tooltipster.css" />
{% endblock %}

{% block js %}
<script type="text/javascript" src="site_media/js/peer-search.js"></script>
<script type="text/javascript" src="site_media/js/jquery.tooltipster.min.js"></script>
<script type="text/javascript" src="site_media/js/packery.pkgd.min.js"></script>
<script type="text/javascript" src="site_media/js/bootbox.min.js"></script>
<script>
$(document).ready(function($) {
	$(".panel-heading").hide();
	$(".panel-body").click(function() {
		$(this).parent(".panel").find(".panel-heading").slideToggle();
	});
});

$(document).on("click", "#show-all-info", function() {
	if ($(this).hasClass("show-state")) {
		$(this).removeClass("show-state").addClass("hide-state").html("Hide all event info");
		$(".panel-heading").slideDown();
	} else {
		$(this).addClass("hide-state").addClass("show-state").html("Show all event info");
		$(".panel-heading").slideUp();
	}
});

$(document).on("click", ".join-btn", function() {
	$(this).toggleClass("btn-success");
	
	var eventPanel = $(this).closest(".event");
	if ($(this).hasClass("btn-success")) {
		// add lily/stephen's image to attendee list
		eventPanel.find(".attending").first().append("<div class='attendee' style='background-image: url( /site_media/images/prek/stephen.jpg'></div>");
		// add ajax call here
	} else {
		//remove image from attendee's list
		// $(this).closest(".event").find(".attending").first().remove
	}


	$(this).text(function(i, text){
		return text === "Join" ? "Joined" : "Join";
	});

	// this stops the click from propogating to the parent
	return false;
});

$(document).on("click", ".delete-event-btn", function() {
	var eventPanel = $(this).closest(".event");
	bootbox.confirm("Are you sure you want to delete your event '"+eventPanel.find(".title").text()+"'?", function(result) {
		if (result) {
			//ajax request to delete shit here
			eventPanel.remove();
		}
	});
});

var $container = $('#events-container');
$container.packery({itemSelector: '.event', gutter: 10});

</script>
{% endblock %}



{% block content %}
<div class="event-header header">
	<h1>Find something to do!</h1>
	<button id="show-all-info" class="btn btn-primary btn-lg show-state">Show all event info</button>
 </div>

<div class="clearfix"></div>
<div class="controls">
	<div class="filters">
		<label class="control-label">Filter events by:</label>
		<div class="radio-inline" id="by-group">
			<label>
				<input type="radio" name="filter-type" value="by-group" checked>
				Group
			</label>
		</div>
		<div class="radio-inline" id="by-peer">
			<label>
				<input type="radio" name="filter-type" value="by-group">
				Peer
			</label>
		</div>
		<br/> 

		<div class="filter-options" id="group-filters">
			<span id="pre-k" class="label group-filter label-success active">Ms. Creevey's Pre-K Class</span>
			<span id="daycare" class="label group-filter label-warning active">Saltsville Daycare Playgroup A</span>
		</div>

		<div class="filter-options" id="peer-filter">
			<input type="text" class="form-control input-lg" id="peer-search" placeholder="Search for a peer...">
		</div>
	</div>
</div>

{% block tiles %}
<div id="events-container">
	{% for event in events %}
	<div class="event panel panel-default">
		<div class="panel-body" style="background-image: url( /site_media/images/{{event.photo.name}} )">
			{% if event.created_by.last_name|stringformat:"s" == "Brown" %}
			<button type="button" class="edit-event-btn btn">
				<span class="glyphicon glyphicon-pencil"></span>
			</button>
			{% endif %}

			<div class="gradient">
				<div class="info">
					<div class="title">{{ event.title }}</div>
					<div class="time">{{ event.date|date:"D, M d, Y"}}<br/>{{ event.start_time|time:"P"}} to {{ event.end_time|time:"P"}}</div>
				</div>
				{% if event.joined %}
				<button class="btn join-btn btn-success">Join</button>
				{% else %}
				<button class="btn join-btn">Join</button>
				{% endif %}
			</div>
		</div>

		<div class="panel-heading">
			<div><label>Created by:</label> The {{ event.created_by.last_name }}s </div>
			<div><label>Location:</label> {{ event.location }} </div>
			<div><label>Description:</label> {{ event.description }}</div>
			<div class="attending"><label>Attending: </label>
				{% for buddy in event.attendees.all %}
				<div class="attendee" style="background-image: url( /site_media/images/{{buddy.photo.name}})"></div>
				{% endfor %}
			</div>

			{% if event.created_by.last_name|stringformat:"s" == "Brown" %}
			<center><button type="button" class="delete-event-btn btn">
				<span class="glyphicon glyphicon-trash"> Delete Event</span>
			</button></center>
			{% endif %}
		</div>
	</div>
	{% endfor %}
</div>
{% endblock %}

{% endblock %}